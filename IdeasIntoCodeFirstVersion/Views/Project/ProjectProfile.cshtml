@model IdeasIntoCodeFirstVersion.ViewModels.ProjectViewModel
@{
    ViewBag.Title = "ProjectProfile";
}

<section class="py-5 bg-light" id="section1">
    <div>
        <div class="container">
            <div class="row">
                <div class="text-center col-12">
                    <div>
                        <h2 class="mb-3 text-center">@Model.Project.Title</h2>
                        @if (Model.Action == true)
                        {
                            <button data-project-id="@Model.Project.ID" class="btn btn-warning btn-sm js-toggle-join">Join</button>

                        }
                        @if (Model.Action == false)
                        {
                            <button data-project-id="@Model.Project.ID" class="btn btn-info  btn-sm js-toggle-join" disabled="disabled">Joined</button>
                        }
                        @if (Model.Action == null)
                        {
                            <button class="btn btn-info btn-sm js-toggle-join" href="#">
                                <i class="fas fa-cog"></i>
                            </button>
                        }

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>



<section class="py-5" id="section2">
    <div>
        <div class="container">
            <div class="row">
                <div class="col-md-3 ">
                    <h3>Description:</h3>
                </div>
                <div class="col-md-9 mt-2">
                    <p>@Model.Project.Description</p>
                </div>
            </div>
            <div class="row mt-2">
                <div class="col-md-3">
                    <h3>Project Admin:</h3>
                </div>
                <div class="col-md-9">
                    <a href="@Url.Action("DeveloperProfile", "Developer", new { ID=Model.Project.Admin.ID })">
                        <img class="rounded-circle" src="~/Content/Images/ProfilePicture/@Model.Project.Admin.ID/@Model.Project.Admin.Picture" style="width: 50px;">
                        <small>@Model.Project.Admin.User.Name</small>
                    </a>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-3 ">
                    <h3>Team Members:</h3>
                </div>
                <div class="col-md-9 mt-2">
                    <div class="row">
                        <div class="row">
                            @foreach (var member in Model.Project.Team.TeamMembers)
                            {
                                <a href="@Url.Action("DeveloperProfile", "Developer", new { ID=member.ID })">
                                    <div class="col-md-1 column">
                                        <img class="rounded-circle" src="~/Content/Images/ProfilePicture/@member.ID/@member.Picture" style="width: 50px;">
                                        <small>@member.User.Name</small>
                                    </div>
                                </a>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="py-5 bg-light" id="section3">
    <div>
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <div class="panel">
                        <div class="panel-heading text-center">
                            <h4>Prog. Languages</h4>
                        </div>
                        <div class="panel-body">
                            @foreach (var progLanguages in Model.Project.ProgrammingLanguages)
                            {
                                <a href="#" class="list-group-item text-dark badge badge-pill badge-primary" id="language">@progLanguages.Name</a>
                            }

                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="panel">
                        <div class="panel-heading text-center">
                            <h4>Categories</h4>
                        </div>
                        <div class="panel-body">
                            @foreach (var category in Model.Project.ProjectCategories)
                            {
                                <a href="#" class="list-group-item text-dark badge badge-pill badge-primary" id="category">@category.Name</a>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>


<section class="py-5" id="section4">
    <div>
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h3> Status:</h3>
                </div>
                <div class="col-md-6">
                    @if (Model.Project.Active)
                    {
                        <button class="btn btn-default btn-success">Active</button>
                    }
                    else
                    {
                        <button class="btn btn-default btn-secondary" disabled="disabled">Inactive</button>
                    }
                </div>
            </div>
        </div>
    </div>
</section>

<section class="py-5 bg-light" id="section5">
    <div>
        <div class="container">
            <div class="row" id="comments">

                <div class="col-12 text-center pb-3">
                    <h2><strong>Comments</strong></h2>
                </div>

                <div class="col-10">
                    <form class="comment-form" method="post" action="">
                        <textarea id="commentText" class="comment-area col-md-12" name="user_comment"
                                  placeholder="Write your comment here"></textarea>
                    </form>
                </div>
                <div class="col-2 mt-2">
                    <button data-project-id="@Model.Project.ID" data-developer-id="@Model.Developer.User.FullName" id="submitComment" type="submit"
                            class="btn  btn-primary">
                        Post
                    </button>
                </div>



                @foreach (var comment in Model.Project.Comments)
                {
                    <div class="row mt-5">

                        <div class="col-1">
                            <img src="~/Content/Images/ProfilePicture/@comment.Developer.ID/@comment.Developer.Picture" class="img img-rounded img-fluid" />
                        </div>

                        <div class="col-11">
                            <p><strong>@comment.Developer.User.FullName</strong></p>
                            <p>@comment.Text</p>
                            <p class="text-secondary text-center">@comment.TimeStamp</p>
                        </div>

                    </div>
                }

            </div>


        </div>
    </div>
</section>




@section Scripts
{
    <script>

  //append does not work must be fixed
        $(document).ready(function () {
            $("#submitComment").click(function (e) {
                var button = $(e.target);
                var commenter = button.attr("data-developer-id");
                var newComment = $("#commentText").val();
                $.ajax({
                    url: '@Url.Action("AddComment","Comment")',
                    method: "post",
                    data: { currentProjectID: button.attr("data-project-id"), commentText: newComment}
                })
                    .done(function () {

                        var text = $("#commentText").val();
                        $("#comments").append('<div class="card-body"> <div class="row"><div class="col-md-2">< img src = "https://image.ibb.co/jw55Ex/def_face.jpg" class= "img img-rounded img-fluid" /> '
                            + ' </div> <div class="col-md-10"> <p><strong>' + commenter + '</strong></p><p>' + text
                            +'</p><p class="text-secondary text-center">'+ '@DateTime.Now' + '</p> </div> </div> </div>')
                        $("#commentText").val('');
                    })
                    .fail(function () {
                          alert("Something failed");
                    });
            });

             $(".js-toggle-join").click(function (e) {
                var button = $(e.target);
                $.post("/api/projects", { ProjectID: button.attr("data-project-id") })
                    .done(function () {
                        button
                            .removeClass("btn-default")
                            .addClass("btn-info")
                            .text("Joined");
                    })
                    .fail(function () {
                        alert("Something failed");
                    });
            });


        });
    </script>
}


<style type="text/css">
    .jumbotron {
        background-color: white;
        background-image: url("../project.jpg");
    }

    body {
        background-color: black;
    }

    h3 {
        font-weight: bold;
        text-decoration: underline;
        color: lightslategrey;
    }

    h4 {
        font-size: x-large;
        text-align: center;
    }

    small {
        color: dimgray;
        font-size: small;
    }

    p {
        color: dimgray;
        font-size: 20px;
    }

    .panel {
        background-color: grey;
    }

    #category {
        background-color: lightgray;
        text-align: center;
        font-size: 16px;
    }

    #language {
        background-color: lightgray;
        text-align: center;
        font-size: 16px;
    }
</style>


